<!doctype html><html lang=cn class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=content-security-policy content="script-src 'self' 'unsafe-inline'; script-src-elem 'self' 'unsafe-inline' https://code.jquery.com https://cdn.jsdelivr.net https://fonts.googleapis.com;"><meta name=generator content="Hugo 0.102.3"><link rel=canonical type=text/html href=/cn/blog/><link rel=alternate type=application/rss+xml href=/cn/blog/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Blog | HugeGraph</title><meta name=description content="欢迎阅读 HugeGraph 博客！
这里汇集了 HugeGraph 生态的技术文章、最佳实践和社区动态：

HugeGraph (OLTP): 图数据库核心功能、性能优化、存储引擎等
HugeGraph-AI: AI 与图计算结合的应用案例
HugeGraph Computing (OLAP):  …"><meta property="og:title" content="Blog"><meta property="og:description" content="Apache HugeGraph 官网"><meta property="og:type" content="website"><meta property="og:url" content="/cn/blog/"><meta property="og:site_name" content="HugeGraph"><meta itemprop=name content="Blog"><meta itemprop=description content="Apache HugeGraph 官网"><meta name=twitter:card content="summary"><meta name=twitter:title content="Blog"><meta name=twitter:description content="Apache HugeGraph 官网"><link rel=preload href=/scss/main.min.3276a99ddd5b15fbe3fcf20f8237086c2cbb526b572f4f06a2246fa9279ed395.css as=style><link href=/scss/main.min.3276a99ddd5b15fbe3fcf20f8237086c2cbb526b572f4f06a2246fa9279ed395.css rel=stylesheet integrity><script src=/js/jquery.min.js></script>
<link rel=stylesheet href=/css/prism.css><script>document.addEventListener("DOMContentLoaded",function(){var t=document.querySelectorAll("pre code.language-mermaid, code.language-mermaid, pre code.language-fallback, code.language-fallback"),e=[];t.forEach(function(t){var n=t.textContent.trim();(n.match(/^(graph|flowchart|sequenceDiagram|classDiagram|pie|gitgraph|erDiagram|journey|gantt|stateDiagram|mindmap|timeline|quadrantChart)/m)||n.includes("-->")||n.includes("->")||n.includes("style ")||n.includes("fill:"))&&e.push(t)}),e.length>0&&(e.forEach(function(e){var n,t=document.createElement("div");t.className="mermaid",t.textContent=e.textContent.trim(),n=e.closest("pre")||e.parentElement,n.parentNode.replaceChild(t,n)}),mermaid.initialize({startOnLoad:!0,theme:"default",securityLevel:"loose"}))})</script></head><body class="td-section td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/cn/><span class=navbar-logo><svg id="图层_1" data-name="图层 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 16 16"><defs><style>.logo-cls-1{fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:.5px;opacity:.3}.logo-cls-2{fill:#229efa}.logo-cls-3{fill:#9948f7}.logo-cls-4{fill:#33bc7a}.logo-cls-5{fill:url(#未命名的渐变_3)}.logo-cls-6{fill:url(#未命名的渐变_13)}.logo-cls-7{fill:url(#未命名的渐变_11)}</style><linearGradient id="未命名的渐变_3" x1="6.16" y1="14.63" x2="6.16" y2="6.01" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#2e3192"/><stop offset="0" stop-color="#229efa"/><stop offset=".44" stop-color="#239cf8"/><stop offset=".6" stop-color="#2795f2"/><stop offset=".71" stop-color="#2d8ae8"/><stop offset=".81" stop-color="#3679d9"/><stop offset=".89" stop-color="#4263c6"/><stop offset=".95" stop-color="#5048af"/><stop offset="1" stop-color="#5c319b"/></linearGradient><linearGradient id="未命名的渐变_13" x1="10.75" y1="8.2" x2="4.49" y2="1.94" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#991146"/><stop offset="0" stop-color="#326b4e"/><stop offset=".02" stop-color="#3a685c"/><stop offset=".07" stop-color="#506180"/><stop offset=".13" stop-color="#645aa0"/><stop offset=".19" stop-color="#7554bc"/><stop offset=".26" stop-color="#8250d2"/><stop offset=".35" stop-color="#8d4ce3"/><stop offset=".45" stop-color="#944aee"/><stop offset=".6" stop-color="#9848f5"/><stop offset="1" stop-color="#9948f7"/></linearGradient><linearGradient id="未命名的渐变_11" x1="15.34" y1="6.67" x2="7.88" y2="10.98" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#33bc7a"/><stop offset=".45" stop-color="#32ba7a"/><stop offset=".61" stop-color="#2fb37c"/><stop offset=".73" stop-color="#29a87e"/><stop offset=".82" stop-color="#219782"/><stop offset=".9" stop-color="#168186"/><stop offset=".97" stop-color="#09668b"/><stop offset="1" stop-color="#03598e"/></linearGradient></defs><title>logo</title><rect class="logo-cls-1" x="-143.14" y="-373.46" width="597.8" height="424.44"/><circle class="logo-cls-2" cx="12.02" cy="1.83" r="1.33"/><circle class="logo-cls-3" cx="12.02" cy="14.17" r="1.33"/><circle class="logo-cls-4" cx="1.33" cy="8" r="1.33"/><path class="logo-cls-5" d="M7.91 10h0a2.65 2.65.0 01-.23-3.74A1.75 1.75.0 017.91 6h0A2.66 2.66.0 014.4 6h0a1.81 1.81.0 01.24.24A2.65 2.65.0 014.4 10h0a2.62 2.62.0 00-.89 2 2.65 2.65.0 104.4-2z"/><path class="logo-cls-6" d="M12.19 5.49a2.78 2.78.0 01-.5.11A2.64 2.64.0 018.76 3.5h0a2.65 2.65.0 10-2.6 3.17A2.6 2.6.0 007 6.53H7a2.65 2.65.0 013.44 2 2.94 2.94.0 010-.51 2.65 2.65.0 011.75-2.53z"/><path class="logo-cls-7" d="M13 5.35a2.64 2.64.0 00-2.59 2.12h0a3 3 0 01-.08.32A2.65 2.65.0 017.54 9.58a2.86 2.86.0 00.37.41h0a2.63 2.63.0 01.9 2 2.84 2.84.0 01-.05.51 2.64 2.64.0 013.12-2.06l.32.08h0a2.6 2.6.0 00.84.14 2.65 2.65.0 100-5.3z"/></svg></span><span class=font-weight-bold>HugeGraph</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cn/docs/><i class='fas fa-book pr-2'></i><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cn/blog/><i class='fas fa-book pr-2'></i><span>Blog Posts</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/apache/incubator-hugegraph target=_blank><i class='fab fa-github pr-2'></i><span>GitHub</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cn/docs/download/download/><i class='fas fa-download pr-2'></i><span>Download</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/cn/community/><span>Community</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/blog/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/cn/blog/>Return to the regular view of this page</a>.</p></div><h1 class=title>Blog</h1><ul><li><a href=#pg-017e54bfc341e83f5dbd291556d27936>HugeGraph (OLTP)</a></li><ul><li><a href=#pg-c9efd20eee29b9b777fb17babb36b99e>ToplingDB</a></li><ul><li><a href=#pg-c0c059d926fe77d26123de0d5d36ea32>ToplingDB Quick Start</a></li><li><a href=#pg-d18422f3f809936c08509c172dda5102>ToplingDB YAML configuration file</a></li></ul></ul><li><a href=#pg-61f87ddbd43513bef0d54a5e28d5df49>HugeGraph ToolChain</a></li><ul></ul><li><a href=#pg-9f424257ab006c02f8d64fda4fc78efb>HugeGraph-AI</a></li><ul><li><a href=#pg-876c6ec0190607c317590aaf623d092a>Agentic GraphRAG</a></li></ul><li><a href=#pg-34c1f369b00eeaf75d74666cb8a0b9be>HugeGraph Computing (OLAP)</a></li><ul></ul></ul><div class=content><p>欢迎阅读 HugeGraph 博客！</p><p>这里汇集了 HugeGraph 生态的技术文章、最佳实践和社区动态：</p><ul><li><strong>HugeGraph (OLTP)</strong>: 图数据库核心功能、性能优化、存储引擎等</li><li><strong>HugeGraph-AI</strong>: AI 与图计算结合的应用案例</li><li><strong>HugeGraph Computing (OLAP)</strong>: 大规模图计算和分析实践</li></ul><p>探索更多内容，提升您的图数据库使用体验！</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-017e54bfc341e83f5dbd291556d27936>HugeGraph (OLTP)</h1><div class="td-byline mb-4"></div></div><div class=td-content><h1 id=pg-c9efd20eee29b9b777fb17babb36b99e>ToplingDB</h1><div class="td-byline mb-4"></div></div><div class=td-content><h1 id=pg-c0c059d926fe77d26123de0d5d36ea32>ToplingDB Quick Start</h1><div class="td-byline mb-4"><time datetime=2025-10-09 class=text-muted>Thursday, October 09, 2025</time></div><h2 id=前置条件>前置条件</h2><ul><li>HugeGraph 版本: > 1.5.0</li><li>Java 版本: >= 11</li><li>确保已下载 <a href="https://github.com/topling/toplingdb?tab=readme-ov-file#compile--run-db_bench">ToplingDB 相关依赖</a></li><li>操作系统: Linux</li></ul><h2 id=启动和配置>启动和配置</h2><blockquote><p><a href=https://github.com/topling/toplingdb>ToplingDB</a>是对 RocksDB 的可配置、可观测扩展，支持通过 YAML 文件进行动态调优，并通过内置 Web Server 实现实时监控</p></blockquote><p>修改 <code>hugegraph.properties</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>backend=rocksdb
</span></span><span style=display:flex><span>serializer=binary
</span></span><span style=display:flex><span>rocksdb.data_path=.
</span></span><span style=display:flex><span>rocksdb.wal_path=.
</span></span><span style=display:flex><span># 配置文件路径
</span></span><span style=display:flex><span># 出于安全性考虑, HG中仅允许 yaml 文件位于conf/graphs目录下
</span></span><span style=display:flex><span>rocksdb.option_path=./conf/graphs/rocksdb_plus.yaml
</span></span><span style=display:flex><span># 是否开启Web Server
</span></span><span style=display:flex><span>rocksdb.open_http=true
</span></span></code></pre></div><p>初始化数据库（第一次启动时或在 <code>conf/graphs/</code> 下手动添加了新配置时需要进行初始化）</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> *hugegraph-<span style=color:#4e9a06>${</span><span style=color:#000>version</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>bin/init-store.sh
</span></span></code></pre></div><p>启动 server</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bin/start-hugegraph.sh
</span></span><span style=display:flex><span>Starting HugeGraphServer...
</span></span><span style=display:flex><span>Connecting to HugeGraphServer <span style=color:#ce5c00;font-weight:700>(</span>http://127.0.0.1:8080/graphs<span style=color:#ce5c00;font-weight:700>)</span>....OK
</span></span></code></pre></div><p>提示的 url 与 <code>rest-server.properties</code> 中配置的 <code>restserver.url</code> 一致</p><p>Web Server 的监听端口在 YAML 文件中通过 <code>http.listening_ports</code> 字段进行配置</p><h2 id=验证toplingdb是否正常工作>验证ToplingDB是否正常工作</h2><h3 id=前提-确保核心参数配置正确>前提: 确保核心参数配置正确</h3><p>检查 <code>hugegraph.properties</code> 中包含:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># 配置文件路径
</span></span><span style=display:flex><span>rocksdb.option_path=./conf/graphs/rocksdb_plus.yaml
</span></span><span style=display:flex><span># 是否开启Web Server
</span></span><span style=display:flex><span>rocksdb.open_http=true
</span></span></code></pre></div><h3 id=方式一-访问web监控界面>方式一: 访问Web监控界面</h3><p>可视化访问Web监控页面，页面示例如下图所示:</p><div style=text-align:center><img src=/blog/images/images-server/toplingdb-web-server.png alt=image width=400></div><p>通过终端验证:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 访问 http://localhost:2011 (端口号取决于 YAML 配置中的 listening_ports)</span>
</span></span><span style=display:flex><span>curl http://localhost:2011 <span style=color:#000;font-weight:700>|</span> grep topling
</span></span></code></pre></div><p>得到以下输出说明页面正常:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>p</span><span style=color:#000;font-weight:700>&gt;&lt;</span><span style=color:#204a87;font-weight:700>a</span> <span style=color:#c4a000>href</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;https://topling.cn&#34;</span><span style=color:#000;font-weight:700>&gt;</span>Topling Inc.<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>a</span><span style=color:#000;font-weight:700>&gt;</span>This is <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>strong</span><span style=color:#000;font-weight:700>&gt;</span>Engine Inspector<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>strong</span><span style=color:#000;font-weight:700>&gt;</span>, for metrics, see <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>a</span> <span style=color:#c4a000>href</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;javascript:grafana()&#39;</span><span style=color:#000;font-weight:700>&gt;</span>Grafana<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>a</span><span style=color:#000;font-weight:700>&gt;</span>!<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>p</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h3 id=方式二-检查日志中的-toplingdb-初始化信息>方式二: 检查日志中的 ToplingDB 初始化信息</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tail -f logs/hugegraph-server.log <span style=color:#000;font-weight:700>|</span> grep -i topling
</span></span></code></pre></div><p>类似输出说明存储引擎启动为ToplingDB:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>2025</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>14</span> <span style=color:#000>08</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>56</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>25</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>db</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>open</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>1</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>INFO</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>o</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>a</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>h</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>b</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>s</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>r</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>RocksDBStdSessions</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>SidePluginRepo</span> <span style=color:#000>found</span><span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#000>Will</span> <span style=color:#000>attempt</span> <span style=color:#000>to</span> <span style=color:#000>open</span> <span style=color:#000>multi</span> <span style=color:#000>CFs</span> <span style=color:#000>RocksDB</span> <span style=color:#000>using</span> <span style=color:#000>Topling</span> <span style=color:#000>plugin</span><span style=color:#ce5c00;font-weight:700>.</span>
</span></span><span style=display:flex><span><span style=color:#000>2025</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>14</span> <span style=color:#000>08</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>56</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>25</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>db</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>open</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>1</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>INFO</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>o</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>a</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>h</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>b</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>s</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>r</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>RocksDBStdSessions</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>Topling</span> <span style=color:#000>HTTP</span> <span style=color:#000>Server</span> <span style=color:#000>has</span> <span style=color:#000>been</span> <span style=color:#000>started</span> <span style=color:#000>according</span> <span style=color:#000>to</span> <span style=color:#000>the</span> <span style=color:#000>listening_ports</span> <span style=color:#000>specified</span> <span style=color:#000>in</span> <span style=color:#ce5c00;font-weight:700>./</span><span style=color:#000>conf</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>graphs</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>rocksdb_plus</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>yaml</span>
</span></span></code></pre></div><h2 id=常见问题排查>常见问题排查</h2><h3 id=问题-1-启动失败提示-yaml-格式错误>问题 1: 启动失败，提示 YAML 格式错误</h3><p>启动时有类似日志：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>2025</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>15</span> <span style=color:#000>01</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>55</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>50</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>db</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>open</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>1</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>INFO</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>o</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>a</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>h</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>b</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>s</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>r</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>RocksDBStdSessions</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>SidePluginRepo</span> <span style=color:#000>found</span><span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#000>Will</span> <span style=color:#000>attempt</span> <span style=color:#000>to</span> <span style=color:#000>open</span> <span style=color:#000>multi</span> <span style=color:#000>CFs</span> <span style=color:#000>RocksDB</span> <span style=color:#000>using</span> <span style=color:#000>Topling</span> <span style=color:#000>plugin</span><span style=color:#ce5c00;font-weight:700>.</span>
</span></span><span style=display:flex><span><span style=color:#f57900>21:</span><span style=color:#000>1</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>891B</span><span style=color:#ce5c00;font-weight:700>):</span><span style=color:#000>ERROR</span><span style=color:#ce5c00;font-weight:700>:</span> 
</span></span><span style=display:flex><span><span style=color:#000>sideplugin</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>rockside</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>3rdparty</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>rapidyaml</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>src</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>c4</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>yml</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>parse</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>cpp</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>3310</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>ERROR</span> <span style=color:#000>parsing</span> <span style=color:#000>yml</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>parse</span> <span style=color:#000>error</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>incorrect</span> <span style=color:#000>indentation</span><span style=color:#ce5c00;font-weight:700>?</span>
</span></span></code></pre></div><p><strong>解决方案</strong>:</p><ol><li>检查 YAML 文件缩进是否正确（必须使用空格，不能使用 Tab）</li><li>验证 YAML 语法: <code>python -c "import yaml; yaml.safe_load(open('conf/graphs/rocksdb_plus.yaml'))"</code></li><li>检查日志中的具体错误信息</li></ol><h3 id=问题-2-web-server-端口冲突>问题 2: Web Server 端口冲突</h3><p>启动时有类似日志：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>2025</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>15</span> <span style=color:#000>01</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>57</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>34</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>db</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>open</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>1</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>INFO</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>o</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>a</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>h</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>b</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>s</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>r</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>RocksDBStdSessions</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>SidePluginRepo</span> <span style=color:#000>found</span><span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#000>Will</span> <span style=color:#000>attempt</span> <span style=color:#000>to</span> <span style=color:#000>open</span> <span style=color:#000>multi</span> <span style=color:#000>CFs</span> <span style=color:#000>RocksDB</span> <span style=color:#000>using</span> <span style=color:#000>Topling</span> <span style=color:#000>plugin</span><span style=color:#ce5c00;font-weight:700>.</span>
</span></span><span style=display:flex><span><span style=color:#000>2025</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>15</span> <span style=color:#000>01</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>57</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>34</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>db</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>open</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>1</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>ERROR</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000>o</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>a</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>h</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>b</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>s</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>r</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>RocksDBStore</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>Failed</span> <span style=color:#000>to</span> <span style=color:#000>open</span> <span style=color:#000>RocksDB</span> <span style=color:#a40000>&#39;</span><span style=color:#000>rocksdb</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>g</span><span style=color:#a40000>&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>rocksdb</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>RocksDBException</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>rocksdb</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Status</span> <span style=color:#000>rocksdb</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>SidePluginRepo</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>StartHttpServer</span><span style=color:#ce5c00;font-weight:700>():</span> <span style=color:#204a87;font-weight:700>null</span> <span style=color:#000>context</span> <span style=color:#000>when</span> <span style=color:#000>constructing</span> <span style=color:#000>CivetServer</span><span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#000>Possible</span> <span style=color:#000>problem</span> <span style=color:#000>binding</span> <span style=color:#000>to</span> <span style=color:#000>port</span><span style=color:#ce5c00;font-weight:700>.</span>
</span></span><span style=display:flex><span>  <span style=color:#000>at</span> <span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>rocksdb</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>SidePluginRepo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>startHttpServer</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Native</span> <span style=color:#000>Method</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>~[</span><span style=color:#000>rocksdbjni</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>8</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>10</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>2</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>20250804</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>074027</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>4</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>jar</span><span style=color:#ce5c00;font-weight:700>:?]</span>
</span></span></code></pre></div><p><strong>解决方案</strong>:</p><ol><li>检查端口是否被占用: <code>lsof -i :2011</code></li><li>修改 YAML 文件中的 <code>listening_ports</code> 配置</li><li>重启 HugeGraph Server</li></ol><h3 id=问题-3-初始化数据库失败>问题 3: 初始化数据库失败</h3><p>类似输出说明无法获取数据库锁，可能缺乏写权限，也可能是被数据库被另外一个进程锁定:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>Caused</span> <span style=color:#000>by</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>rocksdb</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>RocksDBException</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>While</span> <span style=color:#000>lock</span> <span style=color:#000>file</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>rocksdb</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>LOCK</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>Resource</span> <span style=color:#000>temporarily</span> <span style=color:#000>unavailable</span>
</span></span><span style=display:flex><span>        <span style=color:#000>at</span> <span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>rocksdb</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>SidePluginRepo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>nativeOpenDBMultiCF</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Native</span> <span style=color:#000>Method</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>at</span> <span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>rocksdb</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>SidePluginRepo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>openDB</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>SidePluginRepo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>java</span><span style=color:#ce5c00;font-weight:700>:</span><span style=color:#000>22</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p><strong>解决方案</strong>:</p><ol><li>确认配置文件路径正确: <code>rocksdb.option_path=./conf/graphs/rocksdb_plus.yaml</code></li><li>检查数据目录权限: 确保运行用户有读写权限</li><li>查看详细日志: <code>bin/init-store.sh 2>&1 | tee init.log</code></li></ol><h2 id=相关文档>相关文档</h2><ul><li><a href=/cn/blog/2025/09/30/toplingdb-yaml-configuration-file/>ToplingDB YAML 配置详解</a> - 了解配置文件中各参数的含义</li><li><a href=/docs/config/config-option/>HugeGraph 配置说明</a> - HugeGraph 核心配置参考</li><li><a href=https://github.com/topling/toplingdb>ToplingDB GitHub 仓库</a> - 官方文档和最新更新</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d18422f3f809936c08509c172dda5102>ToplingDB YAML configuration file</h1><div class="td-byline mb-4"><time datetime=2025-09-30 class=text-muted>Tuesday, September 30, 2025</time></div><p>RocksDB 提供了丰富的参数配置，但大多数情况下，这些配置需要通过硬编码完成。</p><p><a href=https://github.com/topling/toplingdb>ToplingDB</a> 在此基础上引入了 <strong>SidePlugin + YAML</strong> 的方式，使得配置更加模块化和可组合。</p><p>本文重点介绍 <strong>ToplingDB 扩展参数</strong> 的部分，帮助读者理解这些配置的意义。</p><h2 id=术语说明>术语说明</h2><ul><li><strong>MemTable</strong>: LSM-Tree 在内存中的可写数据结构，接收新写入的数据</li><li><strong>SST (Sorted String Table)</strong>: Memtable 持久化到磁盘后生成的有序键值对文件</li><li><strong>Flush</strong>: 将 MemTable 数据写入磁盘生成 SST 的过程</li><li><strong>Compaction</strong>: 合并多个 SST 文件以优化存储和查询性能的过程</li><li><strong>L0, L1, &mldr; L6</strong>: LSM-Tree 的不同层级，数字越大层级越深</li></ul><h2 id=0-hugegraph-中提供的rocksdb_plusyaml>0. HugeGraph 中提供的rocksdb_plus.yaml</h2><p>下文只包括HugeGraph中所使用的配置参数，ToplingDB支持的完整配置请参考：<a href=https://github.com/topling/sideplugin-wiki-en/wiki>SidePlugin Wiki</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>http</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Web Server 相关配置</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># normally parent path of db path</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>document_root</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/dev/shm/rocksdb_resource</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 静态资源目录, HugeGraph中通过`preload_topling.sh`进行静态资源提取</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>listening_ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;127.0.0.1:2011&#39;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Web Server监听端口，用于管理/监控 如端口被占用，请改为其他端口，例如 2012 或 2013</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>setenv</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 环境变量设置</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>StrSimpleEnvNameNotOverwrite</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StringValue</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>IntSimpleEnvNameNotOverwrite</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16384</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>OverwriteThisEnv</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>#comment: overwrite is default to false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>overwrite</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>force overwrite this env by overwrite true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Cache</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># Cache 相关配置</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>lru_cache</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 定义一个 LRU 缓存实例</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>class</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LRUCache</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>capacity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>8G</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 缓存容量 8GB</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>num_shard_bits</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 分片数量，-1 表示自动</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>strict_capacity_limit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>high_pri_pool_ratio</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0.5</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>use_adaptive_mutex</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>metadata_charge_policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kFullChargeCacheMetadata</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 元数据也计入缓存容量</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>Statistics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 数据采样配置</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stat</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>class</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>default</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>discard_tickers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 丢弃的统计计数器，减少开销</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.block.cache</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.block.cachecompressed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.block</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.memtable.payload.bytes.at.flush</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.memtable.garbage.bytes.at.flush</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.txn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.blobdb</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.row.cache</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.number.block</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.bloom.filter</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.persistent</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.sim.block.cache</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>discard_histograms</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 丢弃的直方图统计项</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic># comment: ....</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.blobdb</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.bytes.compressed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.bytes.decompressed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.num.index.and.filter.blocks.read.per.level</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.num.data.blocks.read.per.level</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.compression.times.nanos</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.decompression.times.nanos</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.read.block.get.micros</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#000>rocksdb.write.raw.block.micros</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic># comment end of array</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic>#stats_level: kAll</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>stats_level</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kDisableAll </span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 禁用所有统计</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>MemTableRepFactory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 内存中 memtable 的实现</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>cspp</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># ToplingDB 独有的高并发内存结构</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>class</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cspp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>mem_cap</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>16G</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 预分配足够的单块内存地址空间，这些内存可以只是保留地址空间，但并未实际分配 对物理内存并无要求，只是为CSPP保留虚拟内存空间</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>use_vm</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>token_use_idle</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>chunk_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>16K</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 内部分配粒度</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>convert_to_sst</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kFileMmap</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 直接将 MemTable 转化为 SST，省去 Flush，可选值：{kDontConvert, kDumpMem, kFileMmap}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>sync_sst_file</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># convert_to_sst 为 kFileMmap 时，SST 转化完成后是否执行 fsync</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>skiplist</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># RocksDB 默认的跳表结构</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>class</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SkipList</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>lookahead</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>TableFactory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>cspp_memtab_sst</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>class</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CSPPMemTabTable</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 与 cspp 配套的 TableFactory</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># empty params</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>bb</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>class</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BlockBasedTable</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># RocksDB 默认的块表</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>checksum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kCRC32c</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>block_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>4K</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>block_restart_interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>index_block_restart_interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>metadata_block_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>4K</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>enable_index_compression</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>block_cache</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;${lru_cache}&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 使用上面定义的 LRU 缓存</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>block_cache_compressed</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>persistent_cache</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>filter_policy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>dispatch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>class</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DispatcherTable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>bb</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 默认使用 BlockBasedTable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>readers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>BlockBasedTable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>bb</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>CSPPMemTabTable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cspp_memtab_sst</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>level_writers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>bb, bb, bb, bb, bb, bb ]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 支持自定义各层写入策略</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>CFOptions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>default</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>max_write_buffer_number</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>memtable_factory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;${cspp}&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 引用上方定义的cspp，使用 cspp 作为 MemTable</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>write_buffer_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>128M</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># set target_file_size_base as small as 512K is to make many SST files,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># thus key prefix cache can present efficiency</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>target_file_size_base</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>64M</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>target_file_size_multiplier</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>table_factory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dispatch</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 引用上方定义的 dispatch, 使用 DispatcherTable Class</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>max_bytes_for_level_base</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>512M</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>max_bytes_for_level_multiplier</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>level_compaction_dynamic_level_bytes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>level0_slowdown_writes_trigger</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>level0_stop_writes_trigger</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>36</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>level0_file_num_compaction_trigger</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>merge_operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>uint64add</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># support merge</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>level_compaction_dynamic_file_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>optimize_filters_for_hits</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>allow_merge_memtables</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>min_write_buffer_number_to_merge</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>compression_per_level</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>kNoCompression</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>kNoCompression</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>kSnappyCompression</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>kSnappyCompression</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>kSnappyCompression</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>kSnappyCompression</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#000>kSnappyCompression</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>DBOptions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>dbo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>create_if_missing</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>create_missing_column_families</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># this is important, must be false to hugegraph</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>max_background_compactions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>-<span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>max_subcompactions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>max_level1_subcompactions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>inplace_update_support</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>WAL_size_limit_MB</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>statistics</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;${stat}&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># 使用上面定义的统计配置</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>max_manifest_file_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>100M</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>max_background_jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>8</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic># 设置flush和compaction线程总数 建议设置为 (cpu核数 / 2)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>compaction_readahead_size</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>memtable_as_log_index: true # 此配置结合 convert_to_sst</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kFileMmap 可实现[omit L0 Flush](https://github.com/topling/toplingdb/wiki/Omit-L0-Flush)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><strong>关键要点</strong>:</p><ul><li><code>listening_ports: '127.0.0.1:2011'</code> 指定Web Server监听端口为2011，并且仅允许本地访问</li><li><code>memtable_as_log_index: true</code> 与 <code>convert_to_sst: kFileMmap</code> 结合实现<a href=https://github.com/topling/toplingdb/wiki/Omit-L0-Flush>omit L0 Flush</a></li><li><code>memtable_factory: "${cspp}"</code> 指定了内存结构采用<code>CSPP Memtable</code></li><li><code>table_factory: dispatch</code> 指定了TableFactory使用YAML中自定义的<code>DispatcherTable</code>结构</li></ul><h2 id=1-插件化配置与引用机制>1. 插件化配置与引用机制</h2><ul><li><strong>YAML 插件化</strong>：配置文件以对象形式组织，每个对象可以单独定义并在其他地方引用。</li><li><strong>引用语法</strong>：通过 <code>${lru_cache}</code>、<code>${cspp}</code> 等方式在不同段落复用对象。</li><li><strong>DispatcherTable</strong>：允许在不同层级或场景下选择不同的 TableFactory。RocksDB 原生只能指定单一 TableFactory。</li></ul><p>ToplingDB YAML 引用与复用图示:</p><div style=text-align:center><img src=/blog/images/images-server/toplingdb-yaml-ref.png alt=image width=800></div><p>这种机制使得配置更灵活，便于在复杂场景下组合不同组件。</p><h2 id=2-新的-memtable-实现cspp>2. 新的 MemTable 实现：CSPP</h2><p>ToplingDB 提供了一个 RocksDB 原生没有的 MemTable 类型，通过以下参数配置：</p><h3 id=mem_cap>mem_cap</h3><p><code>mem_cap</code> 是指在内存地址空间中，为 CSPP 预留的空间大小，这些内存可以只是<strong>保留地址空间，并未实际分配的</strong>。
<code>mem_cap</code> 真正占用的内存大小约为 <code>write_buffer_size</code> 。</p><h4 id=mem_cap-设计背景>mem_cap 设计背景</h4><p>CSPP 的底层算法为了支持高并发写入，采用了预分配内存的策略。
当预分配的内存被写满时，新的写入操作将无法继续。
然而，RocksDB 本身缺乏一种机制，使得 memtable 能够主动反馈 &lsquo;预分配内存已满，需要切换到新的 memtable&rsquo; 。
由于其函数调用链路复杂，难以通过重构来实现这一机制，因此 <code>CSPP</code> 只能通过参数设计来适配 RocksDB 的行为。</p><h4 id=mem_cap-核心思路>mem_cap 核心思路</h4><p>ToplingDB 将 <code>mem_cap</code> 设置为远大于 <code>write_buffer_size</code>，从而避免 RocksDB 在向 Memtable 写入时过早触发“内存已满”的错误。
在 CSPP 初始化（New）时，会再次检查，如果发现 <code>mem_cap</code> 设置过小，则会自动调整为 <code>2 * write_buffer_size</code>，以确保写入过程的稳定性。</p><p><code>mem_cap</code> 默认值为 2G，有效最大值为 16G。</p><ul><li>小型部署（&lt; 16GB 内存）: 建议设置为系统内存的 20-30%</li><li>中型部署（16-64GB 内存）: 建议设置为 8-16G</li><li>大型部署（> 64GB 内存）: 建议设置为 16G</li></ul><h3 id=use_vm>use_vm</h3><p>在使用 malloc/posix_memalign 分配内存时，地址空间可能是已经实际分配的（位于堆空间中，已有对应的物理页面），而 CSPP 在分配时只需要获得保留的地址空间。
<code>use_vm</code> 选项为 <code>true</code> 时会强制使用 <code>mmap</code> 分配内存，从而保证分配的一定时是保留地址空间，但并不实际占用物理页面。
<code>use_vm</code> 默认值为 <code>true</code>。如果用户物理内存空间充足，建议关闭此选项，<code>mmap</code> 分配的虚拟内存空间在建立对物理地址的映射时会触发大量minor page fault，可能会影响性能。</p><h3 id=convert_to_sst>convert_to_sst</h3><p><code>convert_to_sst</code> 支持以下三种枚举值:</p><ul><li><code>kDontConvert</code>: 禁用该功能，为默认值。使用传统的 Flush 流程，兼容性最好，适合对稳定性要求高的场景</li><li><code>kDumpMem</code>: 转化时将 MemTable 的整块内存写入 SST 文件，避免 CPU 消耗，但未降低内存消耗</li><li><code>kFileMmap</code>: 将 MemTable 内容 mmap 到文件，这是关键功能，同时降低 CPU 和内存消耗，可同时将 DBOptions.memtable_as_log_index 设为 true 从本质上消除 MemTable Flush</li></ul><p>这些参数为数据写入路径提供了更多可调节空间，用户可按需选择。</p><p>更多设计细节请参考 ToplingDB 作者的撰写的相关博客：<a href=https://github.com/topling/cspp-memtable/blob/memtable_as_log_index/README_EN.md>cspp-memtable</a>, <a href=https://zhuanlan.zhihu.com/p/649435555>ToplingDB CSPP MemTable Design Essentials</a>, <a href=https://zhuanlan.zhihu.com/p/499138254>CSPP Trie Design Analysis</a></p><h2 id=3-tablefactory-扩展>3. TableFactory 扩展</h2><ul><li><strong>CSPPMemTabTable</strong>：与 <code>cspp</code> MemTable 配套的 TableFactory。</li><li><strong>DispatcherTable</strong>：支持为不同层级指定不同的 TableFactory，例如：<ul><li>默认使用 BlockBasedTable。</li><li>特定层级可以使用 CSPPMemTabTable。</li></ul></li></ul><p>这类灵活性在 RocksDB 原生配置中并不存在。</p><h2 id=4-统计与观测控制>4. 统计与观测控制</h2><ul><li><strong>discard_tickers / discard_histograms</strong>：可以精确指定哪些统计项需要丢弃。</li><li><strong>stats_level: kDisableAll</strong>：结合上述配置，可以灵活控制统计开销。</li></ul><p>相比 RocksDB 的粗粒度控制，ToplingDB 提供了更细的调节方式。</p><h2 id=5-dboptions-新增参数>5. DBOptions 新增参数</h2><ul><li><strong>memtable_as_log_index: true</strong>：允许使用 MemTable 作为日志索引，加快恢复速度。</li></ul><h2 id=6-安全注意事项>6. 安全注意事项</h2><p><strong>Web Server 安全配置</strong>:</p><ul><li>Web Server 页面由ToplingDB提供，不包含权限认证功能</li><li>默认设置 <code>listening_ports: '127.0.0.1:2011'</code> 仅限本地访问</li><li>生产环境建议配置防火墙规则，仅允许内网访问</li><li>如需禁用 Web Server，在 <code>hugegraph.properties</code> 中设置 <code>rocksdb.open_http=false</code></li></ul><p><strong>共享内存安全</strong>:</p><ul><li><code>document_root: /dev/shm/rocksdb_resource</code> 使用共享内存目录</li><li>多用户环境需要注意文件权限设置，避免未授权访问</li></ul><h2 id=7-总结>7. 总结</h2><p>ToplingDB 在 RocksDB 的基础上增加了以下能力：</p><ul><li>插件化配置与对象复用</li><li>新的 MemTable 类型（cspp）及配套 TableFactory</li><li>DispatcherTable 支持多工厂调度</li><li>内置 Web Server</li><li>更灵活的统计与观测控制</li><li>特殊 DBOptions（如 memtable_as_log_index）</li></ul><p>这些扩展为用户提供了更多的可调节空间，尤其适合需要高写入性能和灵活运维的场景。</p><h2 id=相关文档>相关文档</h2><ul><li><a href=/cn/blog/2025/10/09/toplingdb-quick-start/>ToplingDB 快速开始</a> – 如何在 HugeGraph 中启用 ToplingDB</li><li><a href=https://github.com/facebook/rocksdb/wiki/Setup-Options-and-Basic-Tuning>RocksDB 官方配置文档</a> – 了解基础配置项</li><li><a href=https://github.com/topling/sideplugin-wiki-en/wiki>SidePlugin Wiki</a> – ToplingDB 完整配置参考</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-61f87ddbd43513bef0d54a5e28d5df49>HugeGraph ToolChain</h1><div class="td-byline mb-4"></div></div><div class=td-content style=page-break-before:always><h1 id=pg-9f424257ab006c02f8d64fda4fc78efb>HugeGraph-AI</h1><div class="td-byline mb-4"></div></div><div class=td-content><h1 id=pg-876c6ec0190607c317590aaf623d092a>Agentic GraphRAG</h1><div class="td-byline mb-4"><time datetime=2025-10-29 class=text-muted>Wednesday, October 29, 2025</time></div><h1 id=项目背景>项目背景</h1><p>为了应对模型训练数据和现实生活中实际数据之间存在的时效性差异问题，RAG技术应运而生。RAG，顾名思义就是通过向外部数据源获取对应的数据（Retrieval），用于增强（Argument）大模型生成（Generation）回答质量的技术。</p><p>最早的RAG采用简单的Retrieval - Generation架构，我们拿到用户给出的问题，进行一定的预处理（关键词提取等等），得到预处理之后的问题，接着通过Embedding Model从海量资料中抓取相关的资料作为Prompt交给大模型用于增强模型回答的质量。</p><p>但是基于语义相似性匹配进行相关语料的抓取未必能够处理所有情况，因为能够用于增强回答质量的语料不一定和问题本身存在语义相似性。一个常见的例子就是：**告诉我“提出水是万物的本源”的哲学家的徒弟提出的本体论观点。**而我们的语料中并不直接存在这个问题的答案，语料库中可能提到：</p><ol><li>泰勒斯提出水是万物的本源</li><li>泰勒斯的弟子有阿纳克西曼德</li><li>阿纳克西曼德将没有任何形式规定性的阿派朗认定为万物的本源</li></ol><p>如果单纯从语义相似度匹配出发，我们大概率只能retrieval到第一个句子用于增强大模型的回答。但是缺失语料2和语料3的情况下，如果我们所使用的大模型训练语料中没有哲学相关知识，在缺失这些关键信息的情况下，大模型将无法正确回答这些问题，甚至会出现“幻觉”。</p><p>因此GraphRAG技术诞生了，常见的GraphRAG包含两个步骤：</p><ol><li>Offline: 我们需要离线对语料库进行图索引的构建（将非结构化语料转化为结构化数据存储到图数据库中）</li><li>Online: 当GraphRAG系统接收到用户问题时，根据图数据库捕捉到的语料库中不同实体之间的关联关系，我们可以从图数据库中抓取到上面的三句话（具体图数据库索引可能如下图所示）</li></ol><div style=text-align:center><img src=/blog/images/images-server/agentic-background.png alt=image width=400></div><p>但是GraphRAG本身也存在几个问题：</p><ol><li>如何构建Graph Index是一门学问，Graph Index会影响到模型回答质量。</li><li>GraphRAG索引构建过程Token消耗巨大</li><li>GraphRAG中存在各种各样的图算法，如何Retrieval效果最好呢？（配置空间过大）</li></ol><p>本次项目主要针对第三个问题展开。我们希望借助大模型的泛化能力使其自动识别用户问题中的意图，然后选择合适配置（比如选择最合适的图算法）从图数据库中读取对应的数据用于增强大模型回答质量——也就是本次项目Agentic GraphRAG的目的所在。</p><h1 id=现有-workflow优雅的解耦未竟的并行><strong>现有 Workflow：优雅的解耦，未竟的并行</strong></h1><p>现在的HugeGraph-AI项目中存在两个核心抽象：</p><ol><li>Operator：表示「原子式的操作单元」，负责完成一个明确的子任务，如向量索引构建、向量相似度查询、图数据相关操作等等</li><li>Workflow：由Operator作为节点构成的<strong>链状</strong>执行流。项目中预定义好的Workflow和项目Demo用例一一对应（如GraphRAG， Vector-Similarity-Based RAG）</li></ol><p>由于Operator的实现需要遵循下面的接口:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Operator</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>	<span style=color:#5c35cc;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>run</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87>dict</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87>str</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Any</span><span style=color:#000;font-weight:700>])</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#204a87>dict</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87>str</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>Any</span><span style=color:#000;font-weight:700>]:</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{}</span>
</span></span></code></pre></div><p>Operator在实际运行时接受字典类型的context对象作为输入，返回的对象也是一个字典，可以用来作为下一个Operator的输入，这样的设计有一个很高明的地方——他将不同的Operator之间的依赖关系和Operator本身的具体实现解耦了，每个Operator是一个相对独立的存在，如果Operator A需要依赖Operator B的输出，那么只需要检查context对象中是否存有Operator B的输出即可。这是一种低耦合的设计。好处是我们能很方便地将不同的Operator自由组合。根据不同的用户输入组装（配置）合适Workflow Serving用户请求，那不正是我们在项目背景中提到的Agentic GraphRAG的目的所在吗？</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>👉🏼 理论上现有设计已经可以正常过渡到Agentic GraphRAG，但是现有设计存在诸多悬而未决的问题：
</span></span><span style=display:flex><span>    1. 现有调度器仅仅支持链状Workflow，缺失了可能存在的并行空间
</span></span><span style=display:flex><span>    2. 现有调度器无法复用被反复使用到的Workflow
</span></span></code></pre></div><h1 id=打破链式束缚拥抱全新架构>打破链式束缚，拥抱全新架构</h1><p>之前的调度器给我们的启发是Operator粒度的解耦是一个不错的设计理念，但是调度器本身能力有限，限制了Workflow的能力。因此我们计划替换项目中的调度器！经过对几种不同的Workflow编排框架进行简单的调研之后，我们认为下面几个特性是我们筛选调度器的标准。（下面我们统一将框架编排对象称为Workflow，Workflow由一系列Task组成）</p><ol><li>并行性：Workflow中没有数据依赖关系的不同Task能否支持自动并行</li><li>低耦合：Task的具体实现应该和Workflow本身解耦（用人话：一种Task可以作为多种不同的Workflow的节点，同时Task的实现是否需要包含与其他Task依赖关系约束？）</li><li>数据共享：由于我们希望不同的Task之间的依赖关系解耦，那我们就需要Workflow粒度的数据共享机制用来在不同的Task共享数据（用于参数传递）</li><li>提供Python接口</li></ol><h2 id=ai框架大乱斗>AI框架大乱斗</h2><p>我们首先将目光放到了现在炙手可热的AI Workflow调度框架。围绕前面提到的几个维度，我们分别调研了下面几种不同的Workflow编排框架——LlamaIndex，Agno，Pydantic-Ai，LangGraph。</p><h3 id=llamaindex>LlamaIndex</h3><p>对于LlamaIndex，我们用一个常见的例子说明LlamaIndex这个框架的设计理念。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>workflows</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Workflow</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>step</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>workflows.events</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>StartEvent</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>StopEvent</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Event</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>StepEvent</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Event</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>message</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87>str</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>MyWorkflow</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Workflow</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@step</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>step_one</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ctx</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ev</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>StartEvent</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#000>StepEvent</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>       <span style=color:#000>current_count</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>ctx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>store</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;count&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>default</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>       <span style=color:#000>current_count</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>ctx</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>store</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>set</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;count&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>current_count</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;step one called once&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>StepEvent</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;launch step two&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>       
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@step</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>step_two</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ctx</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ev</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>StepEvent</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#000>StopEvent</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;step two called once&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>StopEvent</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>从上面这个简单的例子我们可以看到很多问题。首先明确一个观念：Workflow由两个元素构成：Task，Task之间的依赖关系。只要这两个元素确定之后一个Workflow就确定下来了。我们可以看到LlamaIndex中每个Task(对应代码中用@step注解的函数)的实现和Workflow存在依赖关系。因为每个Task的实现都需要传入Event对象作为参数，但是Event参数其实就是对Task之间依赖关系的一种限定。所以LlamaIndex不具备低耦合的特点。同时我们也发现Task作为Workflow类成员函数本身就违背了我们前面提到的Task需要能够在多种不同Workflow中使用的诉求。但是经过调研，LlamaIndex的数据共享和并行特性支持还算不错。只不过从基于事件驱动模型构建的编程接口在保证了接口易用性的同时也牺牲了编程的灵活性。</p><h3 id=agno>Agno</h3><p>同样还是从例子入手</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>agno.workflow</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>Router</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Step</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Workflow</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>route_by_topic</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>step_input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#000>List</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>Step</span><span style=color:#000;font-weight:700>]:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>topic</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>step_input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>lower</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#4e9a06>&#34;tech&#34;</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>topic</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Tech Research&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agent</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>tech_expert</span><span style=color:#000;font-weight:700>)]</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>elif</span> <span style=color:#4e9a06>&#34;business&#34;</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>topic</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Business Research&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agent</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>biz_expert</span><span style=color:#000;font-weight:700>)]</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>else</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;General Research&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agent</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>generalist</span><span style=color:#000;font-weight:700>)]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>workflow</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Workflow</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Expert Routing&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>steps</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Router</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>            <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Topic Router&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#000>selector</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>route_by_topic</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#000>choices</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>tech_step</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>business_step</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>general_step</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Synthesis&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agent</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>synthesizer</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>workflow</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>print_response</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Latest developments in artificial intelligence and machine learning&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>markdown</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>True</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>从这个例子我们可以看到Workflow本身和Task之间的绑定关系是通过指定steps参数确定的。理论上来说定义好一种Task之后我们可以将其用于不同的Workflow中，Agno的设计符合我们的低耦合标准。</p><p>但是数据共享和任务并行方面的支持就存在一定的限制。</p><p>首先是任务并行，例子如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>workflow</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Workflow</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Parallel Research Pipeline&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>steps</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Parallel</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>            <span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;HackerNews Research&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agent</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>hn_researcher</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>            <span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Web Research&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agent</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>web_researcher</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>            <span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Academic Research&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agent</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>academic_researcher</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>            <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Research Step&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Step</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Synthesis&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>agent</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>synthesizer</span><span style=color:#000;font-weight:700>),</span>  <span style=color:#8f5902;font-style:italic># Combines the results and produces a report</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Agno专门设计了并行接口，我们需要在静态编译时（Python哪有编译时？应该叫写代码的时候哈哈😀）明确哪些任务可以并行。但是Agentic GraphRAG最终构造的Workflow有可能是在运行时由模型规划出来的，是动态运行时明确的，出于这样的考量，我们认为Agno的并行特性并不符合我们的要求</p><p>接下来是数据共享，Agno框架中支持三种不同的Task：</p><ol><li>Agent</li><li>由多个Agent构成的Team</li><li>Pure Function</li></ol><p>我们检查了调研时最新版本的Agno源代码，发现Agno支持的状态共享仅限于Agent和Team。那么对于那些适合用Pure Function实现的Task，我们就需要额外支持数据共享的机制。因此Agno的数据共享机制也不符合我们的要求。</p><h3 id=pydantic-ai>Pydantic-Ai</h3><p>我们从官方文档中就看到</p><div style=text-align:center><img src=/blog/images/images-server/agentic-pydantic.png alt=image width=800></div><p>Pydantic-Ai框架竟然不支持Task粒度的自动并行。</p><p>和LlamaIndex框架类似采用事件驱动的编程模型，因此Workflow和Task之间不算是完全解耦，但是值得注意的时Pydantic-Ai的Task是可以用到多个不同的Workflow的。</p><h3 id=langgraph>LangGraph</h3><p>最后的最后，终于还是遇到了LangGraph，之前一直没有调研LangGraph的原因是因为由团队伙伴认为LangGraph本身太重了。在上一个版本中，即使只是使用LangGraph的部分功能（调度），也需要引入LangGraph的完整依赖，引入LangGraph可能会让项目变“重”。时不时在其他开源项目中看到“xxx比LangGraph快xxx倍”诸如此类的字眼也确实影响到我们的决策判断。所以直到此时此刻才把它提上调研日程。</p><p>我们还是来看看LangGraph的例子</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>State</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>TypedDict</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>topic</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87>str</span>
</span></span><span style=display:flex><span>    <span style=color:#000>joke</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87>str</span>
</span></span><span style=display:flex><span>    <span style=color:#000>improved_joke</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87>str</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Nodes</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>generate_joke</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>state</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>State</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;First LLM call to generate initial joke&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>msg</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>llm</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>invoke</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>f</span><span style=color:#4e9a06>&#34;Write a short joke about </span><span style=color:#4e9a06>{</span><span style=color:#000>state</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;topic&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;joke&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>content</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>check_punchline</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>state</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>State</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Gate function to check if the joke has a punchline&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># Simple check - does the joke contain &#34;?&#34; or &#34;!&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#4e9a06>&#34;?&#34;</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>state</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;joke&#34;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#204a87;font-weight:700>or</span> <span style=color:#4e9a06>&#34;!&#34;</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>state</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;joke&#34;</span><span style=color:#000;font-weight:700>]:</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#4e9a06>&#34;Pass&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#4e9a06>&#34;Fail&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>improve_joke</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>state</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>State</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;Second LLM call to improve the joke&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>msg</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>llm</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>invoke</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>f</span><span style=color:#4e9a06>&#34;Make this joke funnier by adding wordplay: </span><span style=color:#4e9a06>{</span><span style=color:#000>state</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;joke&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;improved_joke&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>msg</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>content</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Build workflow</span>
</span></span><span style=display:flex><span><span style=color:#000>workflow</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>StateGraph</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>State</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Add nodes</span>
</span></span><span style=display:flex><span><span style=color:#000>workflow</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;generate_joke&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>generate_joke</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>workflow</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_node</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;improve_joke&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>improve_joke</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Add edges to connect nodes</span>
</span></span><span style=display:flex><span><span style=color:#000>workflow</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_edge</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>START</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;generate_joke&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>workflow</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_conditional_edges</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;generate_joke&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>check_punchline</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;Fail&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;improve_joke&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Pass&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>END</span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>workflow</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_edge</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;improve_joke&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>END</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Compile</span>
</span></span><span style=display:flex><span><span style=color:#000>chain</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>workflow</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>compile</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Invoke</span>
</span></span><span style=display:flex><span><span style=color:#000>state</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>chain</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>invoke</span><span style=color:#000;font-weight:700>({</span><span style=color:#4e9a06>&#34;topic&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;cats&#34;</span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>这是一个我简化后的官方文档中的例子，我们可以看到基于GraphAPI的LangGraph通过调用workflow.add_edge指定Workflow的依赖关系，将Workflow和Task解耦。同时支持全局State作为Workflow的状态进行Task之间的数据共享。根据官方文档的说法，LangGraph是支持Task自动并行执行的。我们总算是找到了符合所有要求的Workflow编排框架了！</p><h3 id=总结>总结</h3><table><thead><tr><th></th><th>并行性</th><th>低耦合</th><th>数据共享</th><th>Python Interface</th></tr></thead><tbody><tr><td>LlamaIndex</td><td>支持</td><td>不支持</td><td>支持</td><td>支持</td></tr><tr><td>Agno</td><td>支持但不符合要求</td><td>支持</td><td>支持但不符合要求</td><td>支持</td></tr><tr><td>Pydantic-Ai</td><td>不支持</td><td>不支持</td><td>支持</td><td>支持</td></tr><tr><td>LangGraph</td><td>支持</td><td>支持</td><td>支持</td><td>支持</td></tr></tbody></table><h2 id=cgraph--graph-with-python-interaface-implement-in-c>CGraph —— Graph with Python Interaface Implement in C++</h2><p>正当我们将目光聚焦于 LangGraph 时，团队伙伴提到了一个新的方案——CGraph，这是由开源创作者Chunel使用C++开发的图调度框架，对标SOTA任务调度框架——taskflow。CGraph，学名Color Graph，虽然是C++项目，但是它很贴心地提供了Python接口。深入了解后，我们发现 CGraph 的设计理念与我们不谋而合：和LangGraph一样，CGraph基于图的声明式 API，完美支持我们所需的并行化、低耦合和数据共享需求。</p><p>如果说“C++ 站在编程语言鄙视链顶端”是个有趣的玩笑，那它背后反映的其实是程序员对底层性能的极致追求。除去这个“先天”优势， CGraph 相比 LangGraph 最大的不同，在于它的<strong>纯粹</strong>——它不构建庞大的生态，只专注于将“任务调度”这一件事做到极致。</p><p>然而，真正让我们下定决心的，是这个项目的“心跳”。我们联系上了作者 Chunel，感受到了 CGraph 作为一个项目旺盛的生命力。在开源世界里，<strong>活力即未来</strong>。一个持续进化、积极响应的社区，远比一个功能冻结的庞然大物更值得信赖。</p><p>我们相信，优秀的技术选型，不仅是功能的匹配，更是对项目未来潜力的认同。（欢迎一同见证它的成长：https://github.com/ChunelFeng/CGraph）</p><div style=text-align:center><img src=/blog/images/images-server/agentic-frame.png alt=image width=800></div><h2 id=架构设计>架构设计</h2><p>起初，我们的目标很纯粹：基于CGraph，打造一个属于我们自己的调度器。然而深入思考之后，我们发现：一个好的调度器，<strong>源于对调度对象的深刻理解</strong>（是时候拷问自己了🤣）。就像CPU调度器和GPU调度器由于其调度对象以及生态定位的不同也会采取不同调度策略。</p><h3 id=抽象设计是否合理>抽象设计是否合理？</h3><p>所以我们开始考察那个被我们称之为Workflow的抽象，在上一个设计中，它是由一系列Operator组成的链表。这样的设计否定了并行的可能，那么如果我们说Workflow是一系列Operator组成的DAG图是否合理呢？</p><p>直观来说这样的定义很合理，但是实际实践下来，我们发现Workflow中的每个节点（后面我们称之为Node）和Operator一一对应却不是一个好的设计，因为我们需要在不同的请求之间复用Workflow（这样可以节省Workflow构造过程中不可避免的资源创建以及一些DAG图校验带来的性能开销）。</p><p>举个例子，向量相似度查询是一个很常见的RAG流程，但是根据不同底层向量数据库暴露的接口不同，我们可能需要提供FaissVectorSearch、VectraVectorSearch等多种目的相同但是具体实现不同的Operator。如果我们将Operator和Workflow中的Node等同，那么我们对于Workflow的复用机会将大大减少，因为使用Faiss进行搜索和使用Vectra进行搜索的Workflow将会是不同的Workflow，但是如果我们将功能类似的向量索引Operator都封装到VectorSearchNode中，那么我们是不是能够有更多的Workflow复用机会呢？在VectorSearchNode的具体实现中我们只需要根据需要调用对应的Operator即可。通过在Workflow和Operator中间加一层的方式，有下面三个好处：</p><ol><li>新增新的Operator，我们只需要修改对应Node的具体实现即可，不需要修改上层Workflow的逻辑。Operator对Node负责，Node对Workflow负责，很好地实现了职能分离。</li><li>拥有更多的Workflow复用的机会。</li><li>通过引入新的Node抽象，我们在重构的过程中不需要修改底层Operator的实现，减轻了重构过程中的心智负担。</li></ol><div style=text-align:center><img src=/blog/images/images-server/agentic-abstract.png alt=image width=800></div><p>既然我们希望跨请求复用同类Workflow，那么我们就需要保证Workflow本身是无状态的，因为如果复用的Workflow还带着上一个请求的状态，用户就可能得到发生意料之外的结果。而Workflow的状态可以分为两种：</p><ol><li>用户输入的状态（我们称之为WorkflowInput）：这部分由用户的请求构成</li><li>Workflow的中间状态（我们称之为WorkflowState）：由Workflow中各节点（Node）在执行过程中产生的临时数据、计算结果等。</li></ol><p>我们需要保证Workflow执行的过程中这两部分状态是干净的。但是这两种不同的状态使用时机又不同，这也就决定了他们截然不同的生命周期：</p><ul><li>WorkflowInput在Workflow执行<strong>前</strong>被构建和注入，在Workflow执行<strong>结束后</strong>其使命便已完成，应被销毁。</li><li>WorkflowState在Workflow执行<strong>前</strong>必须为空或处于初始状态（pristine），在执行<strong>过程</strong>中被动态读写。</li></ul><p>我们利用 CGraph 框架提供的 <code>GParam</code>（全局参数）抽象来实现精细化的状态隔离：</p><ol><li><strong>分离上下文</strong>: 我们为WorkflowInput和WorkflowState定义两个独立的 <code>GParam</code> 上下文。</li><li><strong>注入生命周期钩子</strong>: 我们在工作流的执行逻辑外层进行封装，实现以下自动化清理机制：<ul><li><strong>执行前 (Pre-execution Hook)</strong>: 自动重置（reset）WorkflowState上下文，确保每次执行都在一个“干净的画布”上开始。</li><li><strong>执行后 (Post-execution Hook)</strong>: 自动清理（clear）WorkflowInput上下文，防止其数据泄露到下一次调用。</li></ul></li></ol><p>这样我们可以保证每次Workflow执行时这两种状态中都只包含本次请求的状态。由于WorkflowInput状态在Workflow执行结束就被重置了，我们只能从WorkflowState中有选择性地选择部分数据返回给用户。因此我们得到了一个Flow抽象应该实现的接口。</p><div style=text-align:center><img src=/blog/images/images-server/agentic-lifeline.svg alt=image width=1000></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>BaseFlow</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ABC</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    Base class for flows, defines three interface methods: prepare, build_flow, and post_deal.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>prepare</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>prepared_input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>WkFlowInput</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>**</span><span style=color:#000>kwargs</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        根据用户请求初始化Workflow输入状态（WkFlowInput）
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>build_flow</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>**</span><span style=color:#000>kwargs</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#000>GPipeline</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        用来构建可以运行在CGraph之上的Workflow对象
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@abstractmethod</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>post_deal</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>**</span><span style=color:#000>kwargs</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        从中间状态（WkFlowState）中组装返回给用户的Response
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;&#34;&#34;</span>
</span></span></code></pre></div><p>那么回到Node抽象本身，Node本身是对某个功能的抽象，其底层可能对应着多种不同的抽象。我们大致需要考虑下面几个问题：</p><ol><li>如何将Node层和Operator层尽可能解耦</li><li>Node本身是可以并行的，而Workflow内部存在共享数据，那么如何解决可能存在的并发问题</li></ol><p>我们知道Operator的run方法输入输出都是字典（见上面现有Workflow架构的介绍），为了使得Node层和Operator层尽可能地解耦，我们希望Node层也按照相同的方式调用Operator，因此我们需要为WorkflowState实现一个json序列化方法，在调用Operator前将当前Workflow中间状态转化为字典格式然后交给Operator，然后将Operator执行结果重新反序列化为WorkflowState。为了解决并发访问带来的数据竞争问题，我们可以采用MVCC的并发控制方法，保证Operator操作的是多个不同的副本，得到Operator的返回结果之后，在有并发安全的锁保护的情况下将返回的结果同步到WorkflowState中。因此我们可以得到Node的抽象大致如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>BaseNode</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>GNode</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>//</span> <span style=color:#000>Workflow中间状态</span>
</span></span><span style=display:flex><span>    <span style=color:#000>context</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Optional</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>WkFlowState</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>//</span> <span style=color:#000>Workflow输入状态</span>
</span></span><span style=display:flex><span>    <span style=color:#000>wk_input</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>Optional</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>WkFlowInput</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>None</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>init</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>		    <span style=color:#ce5c00;font-weight:700>//</span> <span style=color:#000>从Pipeline中获取对应状态</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>init_context</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>node_init</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        重写这个方法定制化Node初始化逻辑
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>CStatus</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>run</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        Main logic for node execution, can be overridden by subclasses.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        Returns a CStatus object indicating whether execution succeeded.
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>sts</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>node_init</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>sts</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>isErr</span><span style=color:#000;font-weight:700>():</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>sts</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>context</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>None</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>CStatus</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Context not initialized&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>	      
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>lock</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>try</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#000>data_json</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>to_json</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>finally</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>unlock</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>res</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>operator_schedule</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data_json</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>       
</span></span><span style=display:flex><span>        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>lock</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>try</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>res</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#204a87;font-weight:700>None</span> <span style=color:#204a87;font-weight:700>and</span> <span style=color:#204a87>isinstance</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>res</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>dict</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>                <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>assign_from_json</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>res</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>elif</span> <span style=color:#000>res</span> <span style=color:#204a87;font-weight:700>is</span> <span style=color:#204a87;font-weight:700>not</span> <span style=color:#204a87;font-weight:700>None</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>                <span style=color:#000>log</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>warning</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;operator_schedule returned non-dict type: </span><span style=color:#4e9a06>%s</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>type</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>res</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>finally</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>unlock</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>CStatus</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>operator_schedule</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data_json</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#000>Optional</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>Dict</span><span style=color:#000;font-weight:700>]:</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        根据用户请求或者Workflow状态决定调用哪些Operator
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>raise</span> <span style=color:#c00;font-weight:700>NotImplementedError</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Subclasses must implement operator_schedule&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>至此，我们完成了调度对象Workflow的抽象设计。</p><h3 id=调度器设计>调度器设计</h3><p>在新的调度器体系中，Workflow 对象的实例化与销毁是一项不可忽视的资源开销。为了最大限度地降低延迟、减少内存抖动，我们引入了 Workflow Pool 机制，旨在实现 Workflow 实例的高效复用。
我们充分利用了 CGraph 框架底层提供的 Pool 抽象，并将其应用于 Workflow 的生命周期管理。其核心机制如下：</p><ul><li><strong>分类池化</strong>: 系统为<strong>每种类型</strong>的 Workflow 维护一个专属的、独立的 Workflow Pool。这确保了请求只会被分发给结构完全相同的 Workflow 实例。</li><li><strong>按需获取与动态扩容</strong>: 当一个新请求到达时，调度器的执行逻辑遵循以下策略：<ol><li><strong>查询（Pool Hit）</strong>: 首先，调度器会尝试从对应类型的 Workflow Pool 中获取一个空闲的 Workflow 实例。如果成功，则立即使用该实例处理请求，实现了零开销复用。</li><li><strong>创建（Pool Miss）</strong>: 如果池中无可用实例，调度器将动态创建一个新的 Workflow。这个新实例会立即用于服务当前请求。这种策略保证了系统在高负载下依然具备良好的弹性。</li></ol></li><li><strong>自动归还</strong>: 无论是从池中获取的实例还是新创建的实例，在完成请求处理后，都将被<strong>自动归还</strong>到其所属的 Workflow Pool 中，等待下一次调度。</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>🤔 当前版本的 Scheduler 实现了其最核心的职责，为整个系统提供了一个稳定且高效的调度基座。其主要特性包括：
</span></span><span style=display:flex><span>    1. 能够根据请求类型，准确地调度对应的 Workflow 实例进行处理。
</span></span><span style=display:flex><span>    2. 内置了基于 Workflow 类型的池化（Pooling）机制，通过复用已有实例，显著降低了高并发场景下的对象创建与销毁开销。
</span></span><span style=display:flex><span>    但是在未来，Scheduler值得优化的地方还有很多，比如：
</span></span><span style=display:flex><span>    1. 工作负载感知的资源隔离：并非所有 Workflow 的资源消耗都是均等的。我们将利用 CGraph 提供的线程池绑定功能，为不同类型的 Workflow Pool 分配专属的计算资源。
</span></span><span style=display:flex><span>    2. 生产级容量管理与稳定性：为每个 Workflow Pool 引入可配置的容量上限。在生产环境中，无限制的资源池是潜在的风险点。通过设置池大小的上限，我们可以防止系统在极端负载下耗尽内存，确保服务的稳定性。
</span></span></code></pre></div><p>现在我们可以得到整个项目的整体架构图</p><div style=text-align:center><img src=/blog/images/images-server/agentic-scheduler.png alt=image width=600></div><ol><li>Scheduler收到请求后，首先向PipelinePool查询是否存在对应类型的空闲Pipeline<ol><li>当用户请求到来时，Http Router根据请求的类型将任务委托给核心的Scheduler，请求一个能够处理该类型任务的Pipeline实例。</li></ol><ul><li>若PipelinePool中存在空闲Pipeline，则Scheduler直接返回该Pipeline</li><li>若PipelinePool中不存在空闲Pipeline，则调用对应类型的WorkflowBuilder构建该类型的Pipeline并返回</li></ul></li><li>无论Pipeline是从池中获取的还是新创建的，它都会立即执行请求处理，并将Response返回给用户。处理完成后，该Pipeline实例并<strong>不会被销毁</strong>。相反，它会被<strong>自动释放</strong>并归还到PipelinePool中，状态重置后等待下一次被调度。</li></ol><h3 id=agentic-graphrag-理想与现实的碰撞>Agentic GraphRAG: 理想与现实的碰撞</h3><p>项目之初，我们畅想一个完全“Agentic”的 GraphRAG。你只需告诉它你的问题，一个强大的 LLM 就能像一位资深架构师，从一堆工具（Nodes/Operators）中为你量身定制一套最高效的执行流程（Workflow）。
但理想与现实之间总有距离。我们深入调研了 chat2graph 等类似项目，并实际动手检验效果。结果发现，让 LLM 凭空“创造”一个完美的、无懈可击的执行计划，比我们想象的要难得多。即使是使用 Gemini 2.5 Flash 这样的模型，它在理解复杂指令并将其精确映射到一系列操作时，也时常力不从心。一方面，因为chat2graph的调用链可能会很长，即便大模型推理单步准确率高达95%，但随着调用链路的延长，误差会逐级累积，导致整体任务的成功率急剧下降。另一方面，即使调用链的问题不存在，通过prompt的方式让模型自动规划的准确度目前仍然不能使人满意。完全依赖大模型进行零样本工作流规划的时代，或许还未完全到来。
“一口吃不成胖子”，于是我们做出了一个关键决策：让大模型从零开始构建工作流存在阻碍，但是如果让大模型基于Workflow模板“实例化”具体的Workflow或许是一种可行的方案。我们构建了一个功能强大、高度模块化的 GraphRAG 工作流，而 LLM 的任务，就是根据观众用户请求的特点，为Workflow选择最优配置。这是我们在Agentic GraphRAG和GraphRAG之间找到的一个平衡点。
这让我们的核心问题发生了转变，不再是“如何从零构建”，而是：</p><blockquote><p>我们如何从用户的寥寥数语中，让大模型知道什么是GraphRAG的最优配置？</p></blockquote><p>举个具体的例子：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>👉🏼 给定一个用户请求，我们怎么通过用户的请求推断出最优配置呢？
</span></span><span style=display:flex><span>    具体例子：用户的请求是：告诉我“提出水是万物的本源”的哲学家的徒弟提出的本体论观点。那么采用什么图算法进行知识图谱检索会使得结果更精确呢？
</span></span></code></pre></div><p>综上所述，LLM需要站在自然语言处理和图数据库这两座大山上才能真正窥见问题全貌，而他现在还处于山脚🤣。而这，就是我们下一座亟待翻越的高山。</p><h2 id=反思>反思</h2><p>在本项目中，我们采用了 CGraph 作为底层的图调度框架。其基于 Graph API 的设计，成功地将 Workflow 的定义与各个 Node 的具体实现解耦，赋予了系统良好的扩展性。</p><p>然而，我们也注意到，这种声明式 API 在带来灵活性的同时，也引入了新的编程复杂度。随着我们越来越多地使用 Condition、Region 等 CGraph 的高级特性，用于构建 Workflow 的代码可读性和可维护性开始面临挑战。这引发了我们的一个核心思考：<strong>是否存在一种更为直观和用户友好的接口，既能保持框架的灵活性，又能降低定义复杂流程时的认知负担？</strong></p><p>举一个具体的例子：当我们需要定义一个主 Workflow 和一个作为其子集的子 Workflow 时，目前的实现方式倾向于将子 Workflow 封装为 GRegion，并利用 Condition 节点来控制其执行。这种“合并”式的定义方式虽然功能上可行，但无疑增加了 Workflow 的内在复杂度和理解难度。我们设想，如果 CGraph 框架能原生提供<strong>子图组合 (Subgraph Composition)</strong> 的能力，允许开发者将一个 Workflow 显式声明为另一个 Workflow 的一部分，或许能从根本上简化这类场景的实现。</p><p>尽管存在上述挑战，CGraph 框架在项目中依然发挥了重要作用，显著提升了我们的工程效率：</p><ol><li><strong>性能诊断简化</strong>：框架自带的 Perf 工具使性能瓶颈定位更为便捷，即使大部分耗时最终集中在 LLM 调用上，该工具依然为我们提供了清晰的性能视图。</li><li><strong>调度逻辑下沉</strong>：底层的 Pooling 抽象机制，使我们能够将部分调度逻辑无缝下沉至 C++ 侧，而上层业务代码无需关心其具体实现。</li></ol><p>最后，我想说，技术上的探索固然重要，但这段旅程中最宝贵的财富，是与优秀的同行者共事的经历以及从中获得的成长与感悟。这才是推动我们不断前行的真正动力。</p><h1 id=结语>结语</h1><p>在 HugeGraph-AI 的重构与革新过程中，AI工具的引入大大提升了开发效率，但最终的决策和取舍，仍然需要严谨的思考，Talk is not cheap, thinking is necessary。每当遇到新的技术难题，我们总能提出多种解决方案，而真正的考验在于如何在它们之间进行权衡 (trade-off)。技术世界并非非黑即白，不同的架构选择、方案取舍，往往对应着不同的目标用户与应用场景。我们对 CGraph 的选择，正是这一理念的最佳实践。它并非业界首个图调度框架，但在性能、灵活性与开发成本等诸多维度的考量中，它为我们提供了最契合当前需求的平衡点——在这条充满权衡的道路上，它离我们最近。</p><p>这也让我们更加坚信：一个产品或技术最终被选择，往往不只因其理念的先进，更在于它能否在复杂的现实约束下，为特定问题提供最务实的解法。</p><p>项目暂告一段落，由衷感谢每一位并肩作战的伙伴！这段经历因你们而精彩。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-34c1f369b00eeaf75d74666cb8a0b9be>HugeGraph Computing (OLAP)</h1><div class="td-byline mb-4"></div></div></main></div></div><footer class="bg-dark py-3 row d-print-none"><div class=footer-container><div class="row bg-dark"><div class=col-1></div><div class="col-4 text-center container-center"><div class=footer-row><a href=https://incubator.apache.org/><div class=footer-apache-logo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 473.26 110.22"><defs><style>.cls-1,.cls-2{fill:#fff}.cls-1{fill-rule:evenodd}</style></defs><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><polygon class="cls-1" points="445.81 13.29 467.03 13.29 467.03 15.29 448.03 15.29 448.03 27.09 465.11 27.09 465.11 29.09 448.03 29.09 448.03 41.1 467.24 41.1 467.24 43.11 445.81 43.11 445.81 13.29"/><polygon class="cls-1" points="377.65 13.29 379.86 13.29 379.86 27.13 398.95 27.13 398.95 13.29 401.16 13.29 401.16 43.11 398.95 43.11 398.95 29.13 379.86 29.13 379.86 43.11 377.65 43.11 377.65 13.29"/><path class="cls-1" d="M323.93 43.62a14.55 14.55.0 01-10.63-4.45 14.92 14.92.0 01-3.09-4.88 16.21 16.21.0 01-1.11-6V28.2a15.89 15.89.0 014.24-10.89A14.42 14.42.0 01324 12.78a17.34 17.34.0 013.62.34 14 14 0 013 1 15.6 15.6.0 012.6 1.51 23.56 23.56.0 012.36 1.94L334 19.17a24 24 0 00-2-1.75A12.58 12.58.0 00329.7 16 13.11 13.11.0 00324 14.78a12.11 12.11.0 00-9 3.85 13.55 13.55.0 00-2.64 4.24 14.15 14.15.0 00-1 5.24v.09a14.1 14.1.0 001 5.26 13.67 13.67.0 002.67 4.26 12.2 12.2.0 004 2.85 11.83 11.83.0 005 1 12.39 12.39.0 005.63-1.2A17.89 17.89.0 00334.28 37l1.49 1.45a26.6 26.6.0 01-2.45 2.11 15 15 0 01-2.68 1.64 14.81 14.81.0 01-3.09 1.07A16.42 16.42.0 01323.93 43.62z"/><path class="cls-1" d="M252.32 13.07h2.13l13.89 30h-2.43l-3.79-8.35h-17.6l-3.79 8.35h-2.3l13.89-30zm8.86 19.69-7.84-17.26-7.88 17.26z"/><path class="cls-1" d="M176.74 13.29h10.82a15.11 15.11.0 014.5.62 10.36 10.36.0 013.49 1.78 8.21 8.21.0 012.28 2.86 8.78 8.78.0 01.81 3.85v.09a8.56 8.56.0 01-3.47 7.11 11.22 11.22.0 01-3.71 1.79A16.16 16.16.0 01187 32h-8V43.11h-2.22V13.29zM187.14 30a13.21 13.21.0 003.79-.51A8.65 8.65.0 00193.85 28a6.76 6.76.0 001.89-2.33 6.66 6.66.0 00.69-3v-.09a7 7 0 00-.67-3.15 6.12 6.12.0 00-1.85-2.25 8.68 8.68.0 00-2.85-1.37 13.6 13.6.0 00-3.67-.47H179V30z"/><path class="cls-1" d="M118.64 13.07h2.13l13.88 30h-2.42l-3.8-8.35H110.84l-3.79 8.35h-2.3l13.89-30zm8.86 19.69-7.84-17.26-7.88 17.26z"/><path class="cls-1" d="M471.26 70.85q0 10.83-9.44 13.64l11.44 15.88h-9.38L453.44 85.68h-9.7v14.69h-7.38V56.66h16.27q10 0 14.32 3.37t4.31 10.82zM452.94 79q6.26.0 8.5-1.93c1.5-1.3 2.25-3.37 2.25-6.23s-.77-4.81-2.31-5.88-4.29-1.59-8.25-1.59h-9.39V79z"/><path class="cls-1" d="M422.13 94.34a24 24 0 01-32.77.0 21.65 21.65.0 01-6.63-16.14 21.61 21.61.0 016.63-16.13 24 24 0 0132.77.0 21.61 21.61.0 016.63 16.13 21.65 21.65.0 01-6.63 16.14zM416.72 67a15.32 15.32.0 00-22 0 16.33 16.33.0 000 22.45 15.32 15.32.0 0022 0 16.33 16.33.0 000-22.45z"/><polygon class="cls-1" points="367.18 63.41 367.18 100.37 359.8 100.37 359.8 63.41 346.54 63.41 346.54 56.66 380.44 56.66 380.44 63.41 367.18 63.41"/><path class="cls-1" d="M315.61 90.43l-4.38 9.94h-7.88l19.27-43.71h7.88l19.26 43.71h-7.88l-4.38-9.94zm18.89-6.82-7.94-18-7.95 18z"/><path class="cls-1" d="M286.62 100.37H267.48V56.66h17a24.47 24.47.0 017.66 1.06 10.56 10.56.0 014.79 2.88 11.17 11.17.0 013 7.63c0 3.42-1.09 6-3.25 7.63A14.58 14.58.0 01295.06 77q-.44.22-1.56.72a11.54 11.54.0 016.5 3.61 10.23 10.23.0 012.41 6.91 11.76 11.76.0 01-3.13 8.07q-3.69 4.06-12.63 4.06zm-11.76-6.81h11.57a12.25 12.25.0 006.22-1.29c1.44-.85 2.16-2.47 2.16-4.84q0-5.82-9.32-5.82H274.86v12zm0-18.77h9.38q8 0 8-5.44a5.15 5.15.0 00-1.94-4.5c-1.29-.92-3.3-1.38-6-1.38h-9.44V74.79z"/><path class="cls-1" d="M231 90.37a11.19 11.19.0 0016.26.0q3-3.51 3-9.51V56.66h7.38V81.17q0 9.45-5.19 14.54a19.94 19.94.0 01-26.64.0q-5.19-5.08-5.19-14.54V56.66H228v24.2Q228 86.86 231 90.37z"/><path class="cls-1" d="M196.8 93.68a15.48 15.48.0 006.56-1.28 22.58 22.58.0 005.76-4.1l4.75 4.88A21.87 21.87.0 01197 100.87a22.57 22.57.0 01-16.45-6.38A21.58 21.58.0 01174 78.36a21.78 21.78.0 016.66-16.26q6.66-6.51 16.83-6.51a22 22 0 0117 7.51l-4.69 5.13A20.41 20.41.0 00203.9 64a16.46 16.46.0 00-6.54-1.19 15.54 15.54.0 00-11.13 4.28 14.48 14.48.0 00-4.51 11 15.12 15.12.0 004.48 11.13A14.48 14.48.0 00196.8 93.68z"/><polygon class="cls-1" points="159.05 56.66 166.43 56.66 166.43 100.37 158.42 100.37 133.66 68.48 133.66 100.37 126.28 100.37 126.28 56.66 133.66 56.66 159.05 89.3 159.05 56.66"/><rect class="cls-2" x="108.48" y="56.66" width="7.38" height="43.72"/><path class="cls-1" d="M44.92 15.1c0-.32.0-.64.0-1l.57 1zM33.16 49.33a49.36 49.36.0 00-5.89 20c-.44 6.17.22 11.49 2 16 .25.61.49 1.17.72 1.69q-2.13-1.52-4.07-3.15c-.11-.09-.19-.12-.24-.11a32.87 32.87.0 006.36 7.39c.39.34 1 .5 1.2 1 .46 1.45-.79 14.4 3.22 17.42 2.55 1.92 13.82-.49 17.3-1.62C71.92 102 86 85.26 83.9 61.11 81.61 34.62 64.16 7.68 46.75 1.2 42-.55 41-.39 36.11 1.7 19.13 9 2.45 35.25.21 61.11-1.95 86 13 103 31.9 108.36l1.48.41a19.49 19.49.0 01-1.2-3.36C12.38 99.52 1.31 82 3.1 61.36 4.81 41.65 18 12.6 37.25 4.37c4-1.72 4.41-2 8.48-.44C65.48 11.27 79.27 41.32 81 61.36 82.86 82.78 70.78 100.81 49.89 106a39.89 39.89.0 01-5.62 1c-5.42.55-7.3 1.5-8.29-4.13-2.19-12.44-.54-34.94 4.87-43.57a9.4 9.4.0 01-.4 1.5c-.18.44-.31.71-.36.85-3.24 7.42-5.05 28.95-3.5 33-.45-1.46.35-4.55 1.51-5.18l.66-.47c3.63-2.61 6-6.71 8.59-11.91.0-.07-.13-.07-.25.0a33.72 33.72.0 01-3.78 2.76A43.06 43.06.0 0051.06 68c-.06-.09-.16-.07-.31.0-.87.79-1.76 1.53-2.67 2.23 3.71-6.72 7-14.49 7.32-23.38a38.61 38.61.0 00-3.16-16.59c-.78-1.81-1.88-4-3.29-6.53C46.86 20 45.73 18 45.55 17.7c.1 8.15-1.34 14.78-4.31 19.84a60.7 60.7.0 01-4.09 5.86 46.12 46.12.0 00-3.99 5.93z"/></g></g></svg></div></a><ul class=footer-link><li><a class=white href=https://www.apache.org>Foundation</a></li><li><a class=white href=https://www.apache.org/licenses/>License</a></li><li><a class=white href=https://hugegraph.apache.org/docs/guides/security>Security</a></li><li><a class=white href=https://www.apache.org/events/current-event>Events</a></li><li><a class=white href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li><li><a class=white href=https://www.apache.org/foundation/thanks.html>Thanks</a></li><li><a class=white href=https://privacy.apache.org/policies/privacy-policy-public.html target=_blank>Privacy</a></li></ul></div></div><div class="col-6 text-white text-center container-center"><p>Apache HugeGraph is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.</p><p>Copyright &copy; 2026 The Apache Software Foundation, Licensed under the <a class=white href=https://www.apache.org/licenses/LICENSE-2.0>Apache License Version 2.0</a><br>Apache, the names of Apache projects, and the feather logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries.</p></div><div class=col-1></div></div></div></footer></div><script src=/js/popper.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/mermaid.min.js></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.e5172b35d915ae4e363d053ea36b47944d4363d50a61c129d222283019daf4e0.js integrity="sha256-5RcrNdkVrk42PQU+o2tHlE1DY9UKYcEp0iIoMBna9OA=" crossorigin=anonymous></script>
<script src=/js/prism.js></script></body></html>